---

## Architecture technique proposÃ©e pour une expÃ©rience dÃ©fi transversale

### 1. Centralisation de lâ€™Ã©tat des dÃ©fis actifs
- CrÃ©ation dâ€™un contexte React global (`DefisContext.js`) pour stocker les dÃ©fis en cours et leur Ã©tat.
- Fourniture de ce contexte Ã  toute lâ€™application via le composant racine (`_app.js`).

### 2. AccÃ¨s et rÃ©action sur toutes les pages
- Import du contexte dans chaque page ou composant concernÃ© (repas, suivi, etc.).
- Affichage dynamique dâ€™un bandeau, dâ€™un rappel ou dâ€™un widget selon le dÃ©fi en cours.

### 3. Composants rÃ©utilisables
- `BandeauDÃ©fiActif`â€¯: visible sur toutes les pages si un dÃ©fi est en cours.
- `PopUpDÃ©fi`â€¯: animation/message lors du dÃ©marrage/fin dâ€™un dÃ©fi ou dâ€™une Ã©tape clÃ©.
- `JournalDeBordDÃ©fi`â€¯: accessible partout pour saisir un ressenti ou une note.

### 4. Logique de propagation
- Mise Ã  jour du contexte Ã  chaque action utilisateur (Ã©tape, dÃ©marrage, reset).
- RÃ©activitÃ© immÃ©diate sur toutes les pages consommant le contexte.

### 5. Exemple de flux utilisateur
1. Lâ€™utilisateur dÃ©marre un dÃ©fi (page dÃ©diÃ©e).
2. Le contexte global est mis Ã  jourâ€¯: toutes les pages affichent le bandeau/rappel.
3. Sur la page repas, message spÃ©cifique si le dÃ©fi concerne le repas.
4. Lâ€™utilisateur valide une Ã©tape depuis nâ€™importe quelle pageâ€¯: tout se met Ã  jour.
5. Ã€ la fin du dÃ©fi, animation/message de fÃ©licitations sur toutes les pages.

---
---


# Todo List de conformitÃ© (mise Ã  jour le 17/11/2025 Ã  00:00)

âœ… VÃ©rifier la prÃ©sence des 10 dÃ©fis dans le code
âœ… Comparer formulation, durÃ©e, thÃ¨me et unitÃ© de chaque dÃ©fi
âœ… Corriger la formulation du dÃ©fi 2 pour conformitÃ© stricte
âœ… Mettre Ã  jour la documentation si modification du code
âœ… Faire valider la conformitÃ© finale par un rÃ©fÃ©rent mÃ©tier
âš ï¸ ImplÃ©menter lâ€™expÃ©rience dÃ©fi transversale et dynamique dans toute lâ€™application
# Checklist de conformitÃ© des dÃ©fis (pages/defis.js vs docs/defis.md)

## 1. MÃ©thodologie
- Analyse du fichier `pages/defis.js` (logique d'affichage, gestion, progression des dÃ©fis)
- RÃ©fÃ©rence des 10 mini-dÃ©fis attendus (voir `docs/defis.md`)
- Identification des zones conformes et des Ã©carts
- Plan d'action pour corriger les Ã©carts

---

## 2. Checklist de conformitÃ©

| NÂ° | Nom du dÃ©fi attendu (docs/defis.md)         | PrÃ©sent dans le code ? | Formulation conforme ? | DurÃ©e conforme ? | Remarques |
|----|---------------------------------------------|:---------------------:|:----------------------:|:----------------:|-----------|
| 1  | Pas de dessert par automatisme              |    Oui                |        Oui             |      Oui         |           |
| 2  | Je suis plus fortÂ·e que mes excuses         |    Oui                |   Presque (voir note)  |      Oui         | Formulation code : Â« observe ton envie de â€˜compenserâ€™, sans cÃ©der. Â» (plus courte que la version doc) |
| 3  | 1 portion Ã§a suffit                         |    Oui                |        Oui             |      Oui         |           |
| 4  | Jâ€™Ã©coute mon ventre                         |    Oui                |        Oui             |      Oui         |           |
| 5  | Le faux alliÃ©                               |    Oui                |        Oui             |      Oui         |           |
| 6  | Chaud devantâ€¦ mais doux !                   |    Oui                |        Oui             |      Oui         |           |
| 7  | Je brise la chaÃ®ne                          |    Oui                |        Oui             |      Oui         |           |
| 8  | 1 vraie faim = 1 vrai repas                 |    Oui                |        Oui             |      Oui         |           |
| 9  | Je me programme du plaisir                  |    Oui                |        Oui             |      Oui         |           |
| 10 | 1 cru par jour                              |    Oui                |        Oui             |      Oui         |           |

---


## 3. Analyse de la conformitÃ©

AprÃ¨s comparaison dÃ©taillÃ©e entre le rÃ©fÃ©rentiel JS (`lib/defisReferentiel.js`) et la liste attendue (`docs/defis.md`)â€¯:

- **PrÃ©sence**â€¯: Les 10 dÃ©fis attendus sont bien prÃ©sents dans le code, sans doublon ni oubli.
- **Formulation**â€¯: Toutes les formulations sont trÃ¨s proches ou identiques. Seule la formulation du dÃ©fi 2 est lÃ©gÃ¨rement abrÃ©gÃ©e dans le code (Â« observe ton envie de â€˜compenserâ€™, sans cÃ©der. Â» vs Â« observe ton envie de â€˜compenserâ€™ un oubli ou une erreur, sans cÃ©der. Â»). Les autres formulations sont conformes.
- **DurÃ©e et unitÃ©**â€¯: Toutes les durÃ©es et unitÃ©s sont conformes Ã  la spÃ©cification.
- **ThÃ¨me**â€¯: Les thÃ¨mes sont Ã©galement respectÃ©s.

**Aucun Ã©cart majeur nâ€™a Ã©tÃ© dÃ©tectÃ©.**

### DÃ©tail du seul Ã©cart mineur
- DÃ©fi 2â€¯: Formulation abrÃ©gÃ©e dans le code. Peut Ãªtre allongÃ©e pour coller exactement Ã  la version documentation si besoin de conformitÃ© stricte.

---

## 4. Plan dâ€™action pour corriger les Ã©carts


1. **(Optionnel) Allonger la formulation du dÃ©fi 2 dans le code**
   - Remplacer la description parâ€¯: Â« Pendant 3 repas, observe ton envie de â€˜compenserâ€™ un oubli ou une erreur, sans cÃ©der. Â»
2. **Maintenir la synchronisation documentation / code**
   - Ã€ chaque Ã©volution, vÃ©rifier la conformitÃ© via cette checklist.
3. **Faire valider la conformitÃ©**
   - Relire la checklist et faire valider par un rÃ©fÃ©rent mÃ©tier.

---

> **Remarque :**
> Pour remplir la colonne "PrÃ©sent dans le code ?" et les autres, il faut comparer le contenu du rÃ©fÃ©rentiel de dÃ©fis dans `lib/defisReferentiel.js` (et la logique de `pages/defis.js`) avec la liste ci-dessus.
> 
> **Ã‰tape suivante :**
> - Extraire la liste des dÃ©fis du code (`defisReferentiel`) et la comparer point par point Ã  la liste attendue.





---

## VÃ©rification de comprÃ©hension 18/11/25 11:33 â€” Auto-analyse Copilot

Avantâ€¯: Jâ€™associais Ã  tort la validation de palier et le feedback Ã  la logique â€œidÃ©auxâ€ (plans dâ€™action), pensant que la progression et le feedback devaient Ãªtre gÃ©rÃ©s dans `/pages/ideaux.js`.

AprÃ¨s relecture attentive des fichiers mÃ©tier et codeâ€¯:
- Lâ€™architecture mÃ©tier impose une expÃ©rience dÃ©fi transversale, centralisÃ©e dans un contexte global `DefisContext.js`, accessible sur toutes les pages concernÃ©es (repas, suivi, etc.).
- Les â€œpaliersâ€ dans la logique â€œdÃ©fisâ€ correspondent Ã  des Ã©tapes de progression dâ€™un dÃ©fi, et non aux paliers des plans dâ€™action/idÃ©aux.
- Toute la gestion du feedback, de la progression, des Ã©tapes/paliers de dÃ©fi doit Ãªtre centralisÃ©e dans la logique â€œdÃ©fisâ€â€¯: `lib/defisReferentiel.js`, `lib/initDefisUser.js`, `pages/defis.js`, `components/DefisContext.js`, et les composants UI dÃ©diÃ©s.
- Les fichiers â€œidÃ©auxâ€ ne sont pas concernÃ©s par la gestion des dÃ©fis.

Correctionâ€¯: Le plan dâ€™implÃ©mentation et la liste des fichiers concernÃ©s doivent strictement suivre cette logiqueâ€¯: tout est centrÃ© sur la gestion des dÃ©fis, leur contexte global, et leur affichage transversal sur toutes les pages concernÃ©es.

---



 PLAN Dâ€™IMPLÃ‰MENTATION COPILOT (MISSION : ExpÃ©rience dÃ©fi transversale et dynamique)
âš ï¸ AUCUNE modification de code ne doit Ãªtre produite tant que lâ€™utilisateur nâ€™a pas validÃ© explicitement ce plan dâ€™implÃ©mentation rempli par Copilot.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Titre de la tÃ¢che
ImplÃ©menter lâ€™expÃ©rience dÃ©fi transversale et dynamique dans toute lâ€™application

Description prÃ©cise de la modification attendue
Permettre Ã  lâ€™utilisateur de vivre une expÃ©rience dÃ©fi fluide, cohÃ©rente et motivante sur toutes les pagesâ€¯: affichage dynamique du dÃ©fi actif, progression en temps rÃ©el, feedback visuel et contextuel, synchronisation immÃ©diate de lâ€™Ã©tat du dÃ©fi (dÃ©marrage, Ã©tape, fin) sur lâ€™ensemble de lâ€™application. Garantir la robustesse de la logique mÃ©tier, la rÃ©activitÃ© du contexte global, et la possibilitÃ© de rollback immÃ©diat en cas dâ€™anomalie.

Fichiers concernÃ©s
defisReferentiel.js (dÃ©finition des dÃ©fis)
initDefisUser.js (initialisation Ã©tat utilisateur)
DefisContext.js (contexte global dÃ©fis)
BandeauDefiActif.js (bandeau transversal)
PopUpDefi.js (feedback animation/Ã©tape)
JournalDeBordDefi.js (notes/rÃ©sultats)
defis.js (page principale dÃ©fis)
Toutes pages consommant le contexte dÃ©fi (repas, suivi, etc.)
Audit des risques prÃ©alable
Risque dâ€™incohÃ©rence entre lâ€™Ã©tat global et lâ€™affichage sur certaines pages
Risque dâ€™erreur de rÃ©fÃ©rence (fonction non dÃ©finie, import manquant)
Risque de rÃ©gression sur la progression ou la synchronisation du dÃ©fi
Risque dâ€™affichage incorrect (bandeau, pop-up, journal)
Risque de perte de donnÃ©es utilisateur (notes, progression)
Risque dâ€™absence de rollback en cas dâ€™anomalie
Risque de non-respect du template strict (voir anomalies documentÃ©es dans Anomalie roll back et MARKDOWN)
Documenter ces risques en point de vigilance et les intÃ©grer dans la checklist du contrÃ´le qualitÃ©
Sous-checklist Ã  valider systÃ©matiquementâ€¯:

 VÃ©rification de la prÃ©sence/import de toutes les fonctions, hooks et variables utilisÃ©es dans le code modifiÃ©
Checklist stricte sÃ©curitÃ© & qualitÃ© (Ã  cocher AVANT toute modification)
 Lecture complÃ¨te du code concernÃ© (dÃ©pendances, hooks, variables, fonctionsâ€¦)
 Initialisation systÃ©matique avant usage (hooks, variables, handlers)
 SÃ©paration stricte des Ã©tapesâ€¯: initialisation â” logique â” handler â” rendu
 VÃ©rificationâ€¯: toute fonction ou handler utilisÃ© dans le rendu est prÃ©sent et initialisÃ© avant usage
 Ordre et portÃ©e logiques stricts (jamais dÃ©claration, appel ou usage prÃ©maturÃ©)
 Pas de doublons ni de dÃ©clarations superflues
 ContrÃ´le dâ€™erreur systÃ©matique (compilation, runtime, SSR, rendu, accessibilitÃ©)
 Test du rendu sur tous les cas dâ€™usage et cas limites
 PrÃ©servation stricte des fonctionnalitÃ©s existantes
 Mise Ã  jour prÃ©cise et justifiÃ©e du pourcentage dâ€™avancement
 Toute anomalie ou erreur â” rollback immÃ©diat, rapport dâ€™anomalie avec contexte, date et heure (cf. fichier ANOMALIE)
 Documentation claire de chaque Ã©tape, chaque validation, et toute action automatisÃ©e (Copilot/IA)
 Validation utilisateur OBLIGATOIRE avant toute implÃ©mentation
 Toutes les cases ci-dessus doivent Ãªtre cochÃ©es et documentÃ©es avant de poursuivre.
ContrÃ´les qualitÃ© Ã  prÃ©voir
Tests de synchronisation et dâ€™affichage du dÃ©fi actif sur toutes les pages
Tests de progression et de feedback (bandeau, pop-up, journal)
Tests de non-rÃ©gression sur la logique de dÃ©fi et la propagation du contexte
Tests multi-device et accessibilitÃ©
Analyse de lâ€™audit des risques et vÃ©rification de lâ€™absence dâ€™anomalie
Prise en compte des retours dâ€™expÃ©rience et anomalies documentÃ©es dans Anomalie roll back et MARKDOWN pour renforcer la vigilance et la rigueur
VÃ©rification stricte de la conformitÃ© code/documentation via checklist
ContrÃ´le qualitÃ© renforcÃ©â€¯: audit de risque exhaustif, rapport Markdown avant/aprÃ¨s, respect du template Ã  chaque Ã©tape
Si anomalie/bug identifiÃ©, proposition immÃ©diate de rollback Ã  lâ€™endroit oÃ¹ lâ€™anomalie a Ã©tÃ© dÃ©tectÃ©e (pour revenir Ã  lâ€™Ã©tat sans bug), Ã  confirmer avec lâ€™utilisateur, et documentation dans le fichier Anomalie roll back avec date et heure
Double vÃ©rification et retour dâ€™expÃ©rience (sÃ©curitÃ© process)
Suite aux anomalies rencontrÃ©es lors des prÃ©cÃ©dentes Ã©volutions (voir fichiers Anomalie roll back et MARKDOWN), une double vÃ©rification systÃ©matique est dÃ©sormais exigÃ©eâ€¯:

VÃ©rification stricte de la conformitÃ© code/documentation via checklist
ContrÃ´le qualitÃ© renforcÃ©â€¯: audit de risque exhaustif, rapport Markdown avant/aprÃ¨s, respect du template Ã  chaque Ã©tape
Justificationâ€¯: Cette double vÃ©rification a Ã©tÃ© demandÃ©e pour garantir quâ€™aucune anomalie (fonction non dÃ©finie, import manquant, non-respect du template, absence de rollback, etc.) ne puisse Ãªtre introduite lors dâ€™une Ã©volution. Elle sâ€™appuie sur le retour dâ€™expÃ©rience documentÃ© et vise Ã  sÃ©curiser durablement le process, en Ã©vitant toute rÃ©gression ou perte de conformitÃ©.

Mise Ã  jour de lâ€™avancement
 Non commencÃ© | [ ] En cours | [ ] TerminÃ©
Avancement prÃ©cis/Pourcentage rÃ©el (Ã  MAJ Ã  chaque Ã©tape) : ____â€¯%
Historique des mises Ã  jourâ€¯: ___
Proposition de rollback
Tout risque ou anomalie dÃ©tectÃ©â€¯:
DÃ©crire lâ€™action de rollback, son contexte (fichier, modification en cause), lâ€™alternative sÃ»re proposÃ©e.
Ajouter dans le fichier ANOMALIE roll backâ€¯: date, heure, dÃ©tail complet pour traÃ§abilitÃ©.
Rapport Markdown Copilot
GÃ©nÃ©rer un rapport structurÃ© AVANT et APRÃˆS toute modification (structure, fonctions, hooks, changements, etc.).
Ce rapport doit permettre une validation Ã©clairÃ©e, claire et synthÃ©tique.
Ã€ valider par l'utilisateur avant code.
Validation explicite de lâ€™utilisateur (OBLIGATOIRE)
 Plan validÃ© par lâ€™utilisateur Ã  la dateâ€¯: ___

---

## PLAN Dâ€™IMPLÃ‰MENTATION COPILOT â€” Synchronisation dynamique des catÃ©gories/aliments dans les dÃ©fis

### Titre de la tÃ¢che
Synchronisation dynamique des catÃ©gories et aliments du rÃ©fÃ©rentiel dans les composants de saisie des dÃ©fis

### Description prÃ©cise de la modification attendue
- Les composants de saisie des dÃ©fis doivent utiliser dynamiquement les catÃ©gories et aliments issus du rÃ©fÃ©rentiel alimentaire (`referentiel.js` ou `alimentsRepriseJeune.js`).
- Toute Ã©volution du rÃ©fÃ©rentiel doit se rÃ©percuter automatiquement dans les formulaires de validation des dÃ©fis (plus de duplication ou de liste statique).
- Lâ€™utilisateur doit pouvoir sÃ©lectionner les catÃ©gories/aliments Ã  jour lors de la validation dâ€™un dÃ©fi alimentaire.
- La logique mÃ©tier des dÃ©fis doit rester cohÃ©rente et robuste.

### Fichiers concernÃ©s
- `/components/SaisieDefisDynamiques.js`
- `/components/SaisieDefiAlimentaire.js`
- `/data/referentiel.js`
- `/data/alimentsRepriseJeune.js`
- `/lib/defisReferentiel.js` (pour vÃ©rification de la couverture des comportements)

### Audit des risques prÃ©alable
- Risque dâ€™incohÃ©rence entre le rÃ©fÃ©rentiel et les listes affichÃ©es dans les dÃ©fis
- Risque de rÃ©gression sur la validation ou le filtrage des dÃ©fis alimentaires
- Risque dâ€™erreur dâ€™import ou de synchronisation dynamique
- Risque de perte de robustesse ou de feedback utilisateur
- Rollbackâ€¯: retour Ã  la version prÃ©cÃ©dente et rapport dâ€™anomalie en cas de bug

### ContrÃ´les conformitÃ© Ã  rÃ©aliser
- Lire toutes les entrÃ©es du fichier `Anomalie roll back` pour identifier les points de vigilance.
- CrÃ©er une checklist adaptÃ©e pour Ã©viter les erreurs similaires.
- Analyser les risques et sâ€™assurer quâ€™aucune anomalie nâ€™est prÃ©sente avant de commencer.

### Checklist stricte sÃ©curitÃ© & qualitÃ© (Ã  cocher AVANT toute modification)
- [ ] Lecture complÃ¨te du code concernÃ© (dÃ©pendances, hooks, variables, fonctionsâ€¦)
- [ ] Initialisation systÃ©matique des listes dynamiques depuis le rÃ©fÃ©rentiel
- [ ] SÃ©paration stricte des Ã©tapes (import â” logique â” rendu)
- [ ] VÃ©rification de la synchronisation Ã  chaque Ã©tape clÃ©
- [ ] ContrÃ´le dâ€™erreur systÃ©matique (compilation, runtime, rendu)
- [ ] Test du rendu sur tous les cas dâ€™usage (crÃ©ation, validation, refresh)
- [ ] PrÃ©servation stricte des fonctionnalitÃ©s existantes
- [ ] Mise Ã  jour prÃ©cise de lâ€™avancement
- [ ] Toute anomalie â” rollback immÃ©diat, rapport dâ€™anomalie avec contexte, date et heure
- [ ] Documentation claire de chaque Ã©tape et validation utilisateur obligatoire
- [ ] Toutes les cases ci-dessus doivent Ãªtre cochÃ©es et documentÃ©es avant de poursuivre.

### Mise Ã  jour de lâ€™avancement
- [ ] Non commencÃ© | [ ] En cours | [ ] TerminÃ©
- Avancement prÃ©cis/Pourcentage rÃ©el (**Ã  MAJ Ã  chaque Ã©tape**) : ____â€¯%
- Historique des mises Ã  jourâ€¯: ___

### Point de vigilance
- Rapport basÃ© sur les anomalies passÃ©es pour anticiper les erreurs similaires.
- Informer lâ€™utilisateur de lâ€™impact de cette analyse.

### Proposition de rollback
- Tout risque ou anomalie dÃ©tectÃ©â€¯:
  - DÃ©crire lâ€™action de rollback, son contexte (fichier, modification en cause), lâ€™alternative sÃ»re proposÃ©e.
  - Ajouter dans le fichier `Anomalie roll back`â€¯: date, heure, dÃ©tail complet pour traÃ§abilitÃ©.

### ContrÃ´les qualitÃ© Ã  prÃ©voir
- Test affichage et sÃ©lection des catÃ©gories/aliments dans les dÃ©fis
- Test validation et progression avec les nouveaux aliments
- Test robustesse en cas dâ€™Ã©volution du rÃ©fÃ©rentiel
- Test sauvegarde, restauration, accessibilitÃ©, non-rÃ©gression, cohÃ©rence UI, test multi-device

### Rapport Markdown Copilot
- GÃ©nÃ©rer un rapport structurÃ© AVANT et APRÃˆS toute modification (structure, fonctions, hooks, changements, etc.).
- Ce rapport doit permettre une validation Ã©clairÃ©e, claire et synthÃ©tique.
- Ã€ valider par l'utilisateur avant code.

### AmÃ©lioration continue
- Relier chaque action utilisateur Ã  la mise Ã  jour des Ã©tats mÃ©tier.
- Tester systÃ©matiquement le parcours utilisateur complet aprÃ¨s chaque modification.
- Ajouter un contrÃ´le visuel ou un feedback pour chaque action clÃ©.
- Documenter toute anomalie ou Ã©cart dans le fichier dÃ©diÃ© et proposer immÃ©diatement une correction ou un rollback.
- Relire le plan et le template avant chaque implÃ©mentation pour sâ€™assurer que toutes les Ã©tapes sont respectÃ©es.

### Validation explicite de lâ€™utilisateur (OBLIGATOIRE)
- [ ] Plan validÃ© par lâ€™utilisateur Ã  la dateâ€¯: ___

---

## PLAN Dâ€™IMPLÃ‰MENTATION COPILOT â€” Connexion dynamique au rÃ©fÃ©rentiel alimentaire + correction schÃ©ma Supabase (SaisieDefiAlimentaire.js)

### Titre de la tÃ¢che
Connexion dynamique au rÃ©fÃ©rentiel alimentaire et correction du schÃ©ma dâ€™enregistrement dans le composant SaisieDefiAlimentaire.js

### Description prÃ©cise de la modification attendue
- Remplacer les listes statiques (catÃ©gories, aliments) par des listes dynamiques issues de `data/referentiel.js`.
- Ajouter un datalist pour les suggestions dâ€™aliments et de catÃ©gories.
- PrÃ©remplir automatiquement la catÃ©gorie et les kcal si lâ€™aliment est reconnu.
- Corriger lâ€™objet envoyÃ© Ã  Supabase pour supprimer le champ `fastFood` absent du schÃ©ma rÃ©el.
- Conserver toute la logique mÃ©tier existante (validation, progression, feedback).

### Fichiers concernÃ©s
- `/components/SaisieDefiAlimentaire.js`
- `/data/referentiel.js`

### Audit des risques prÃ©alable
- Risque dâ€™incohÃ©rence entre la saisie et le rÃ©fÃ©rentiel (catÃ©gories/aliments non synchronisÃ©s).
- Risque de rÃ©gression sur la validation ou le filtrage des dÃ©fis alimentaires.
- Risque dâ€™erreur dâ€™import ou de synchronisation dynamique.
- Risque de perte de robustesse ou de feedback utilisateur.
- Risque dâ€™erreur dâ€™enregistrement Supabase (champ absent, typage, etc.).
- Respect strict des hooks React (dÃ©claration en haut du composant).

**Sous-checklist Ã  valider systÃ©matiquementâ€¯:**
- [ ] VÃ©rification de la prÃ©sence/import de toutes les fonctions, hooks et variables utilisÃ©es dans le code modifiÃ©

### Checklist stricte sÃ©curitÃ© & qualitÃ© (Ã  cocher AVANT toute modification)
- [ ] Lecture complÃ¨te du code concernÃ© (dÃ©pendances, hooks, variables, fonctionsâ€¦)
- [ ] Initialisation systÃ©matique avant usage (hooks, variables, handlers)
- [ ] Tous les hooks React (useState, useEffect, useMemo, etc.) sont dÃ©clarÃ©s uniquement en haut du corps du composant fonctionnel
- [ ] SÃ©paration stricte des Ã©tapesâ€¯: initialisation â” logique â” handler â” rendu
- [ ] VÃ©rificationâ€¯: toute fonction ou handler utilisÃ© dans le rendu est prÃ©sent et initialisÃ© avant usage
- [ ] Ordre et portÃ©e logiques stricts (jamais dÃ©claration, appel ou usage prÃ©maturÃ©)
- [ ] Pas de doublons ni de dÃ©clarations superflues
- [ ] ContrÃ´le dâ€™erreur systÃ©matique (compilation, runtime, SSR, rendu, accessibilitÃ©)
- [ ] Test du rendu sur tous les cas dâ€™usage et cas limites
- [ ] PrÃ©servation stricte des fonctionnalitÃ©s existantes
- [ ] Mise Ã  jour prÃ©cise et justifiÃ©e du pourcentage dâ€™avancement
- [ ] Toute anomalie ou erreur â” rollback immÃ©diat, rapport dâ€™anomalie avec contexte, date et heure (cf. fichier ANOMALIE)
- [ ] Documentation claire de chaque Ã©tape, chaque validation, et toute action automatisÃ©e (Copilot/IA)
- [ ] Validation utilisateur OBLIGATOIRE avant toute implÃ©mentation
- [ ] Toutes les cases ci-dessus doivent Ãªtre cochÃ©es et documentÃ©es avant de poursuivre.

### ContrÃ´les conformitÃ© Ã  rÃ©aliser
- Test affichage et sÃ©lection des catÃ©gories/aliments dans le formulaire
- Test validation et progression avec les nouveaux aliments
- Test robustesse en cas dâ€™Ã©volution du rÃ©fÃ©rentiel
- Test sauvegarde, restauration, accessibilitÃ©, non-rÃ©gression, cohÃ©rence UI, test multi-device
- Lire les entrÃ©es du fichier anomalies Roll back pour anticiper les risques et crÃ©er une checklist adaptÃ©e

### Mise Ã  jour de lâ€™avancement
- [x] Non commencÃ© | [ ] En cours | [ ] TerminÃ©
- Avancement prÃ©cis/Pourcentage rÃ©el (**Ã  MAJ Ã  chaque Ã©tape**) : 0â€¯%
- Historique des mises Ã  jourâ€¯: 18/11/2025, plan rÃ©digÃ© et insÃ©rÃ©

### Point de vigilance
- VÃ©rifier la cohÃ©rence des catÃ©gories/aliments avec le rÃ©fÃ©rentiel Ã  chaque rendu.
- VÃ©rifier la suppression du champ `fastFood` dans lâ€™objet envoyÃ© Ã  Supabase.
- VÃ©rifier la robustesse des hooks et la sÃ©paration stricte des Ã©tapes.
- Documenter toute anomalie ou Ã©cart dans le fichier dÃ©diÃ© et proposer immÃ©diatement une correction ou un rollback.

### Proposition de rollback
- En cas dâ€™erreur dâ€™enregistrement ou de rÃ©gression, revenir Ã  la version prÃ©cÃ©dente du composant et documenter lâ€™anomalie dans le fichier dÃ©diÃ© (date, heure, contexte).

### Rapport Markdown Copilot
- GÃ©nÃ©rer un rapport structurÃ© AVANT et APRÃˆS la modification (structure, fonctions, hooks, changements, etc.).
- Ce rapport doit permettre une validation Ã©clairÃ©e, claire et synthÃ©tique.
- Ã€ valider par l'utilisateur avant code.

### AmÃ©lioration continue
- Relier chaque action utilisateur Ã  la mise Ã  jour des Ã©tats mÃ©tier.
- Tester systÃ©matiquement le parcours utilisateur complet aprÃ¨s chaque modification.
- Ajouter un contrÃ´le visuel ou un feedback pour chaque action clÃ©.
- Relire le plan et le template avant chaque implÃ©mentation pour sâ€™assurer que toutes les Ã©tapes sont respectÃ©es.

### Validation explicite de lâ€™utilisateur (OBLIGATOIRE)
- [ ] Plan validÃ© par lâ€™utilisateur Ã  la dateâ€¯: ___

---




ğŸŸ¢ PLAN Dâ€™IMPLÃ‰MENTATION COPILOT (Missionâ€¯: AmÃ©lioration des composants de saisie de dÃ©fis avec logique rÃ©fÃ©rentiel alimentaire)
âš ï¸ AUCUNE modification de code ne doit Ãªtre produite tant que lâ€™utilisateur nâ€™a pas validÃ© explicitement ce plan dâ€™implÃ©mentation rempli par Copilot.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Titre de la tÃ¢che
IntÃ©gration du rÃ©fÃ©rentiel alimentaire et du prÃ©-remplissage automatique (aliments, portions, kcal, catÃ©gories) dans tous les composants de saisie de dÃ©fis

Description prÃ©cise de la modification attendue
Ajouter dans tous les formulaires de saisie de dÃ©fisâ€¯:
Suggestions dynamiques dâ€™aliments et catÃ©gories depuis le rÃ©fÃ©rentiel alimentaire
Gestion des types de portions (CS, tranche, unitÃ©, etc.)
PrÃ©-remplissage automatique des valeurs nutritionnelles (kcal, portion) selon lâ€™aliment choisi
Harmoniser lâ€™UX et la logique avec celle du suivi alimentaire
Conserver toutes les fonctions existantes, ajout en complÃ©ment
Documentation et rapport dâ€™anomalie Ã  chaque Ã©tape
Fichiers concernÃ©s
SaisieDefiAlimentaire.js
SaisieDefisDynamiques.js
referentiel.js
/docs/Anomalie roll back
(Ã€ complÃ©ter selon audit finalâ€¯: autres composants de saisie de dÃ©fi)
Audit des risques prÃ©alable
Lire toutes les entrÃ©es du fichier docs/Anomalie roll back
Identifier les zones de risques rÃ©currentes ou critiques (erreurs passÃ©es, conflits, rÃ©gressions, problÃ¨mes de conformitÃ©)
IntÃ©grer ces points dans la checklist de vigilance et dans lâ€™audit des risques avant toute modification
Risque de conflit avec la logique mÃ©tier existante
Risque de rÃ©gression sur la validation des dÃ©fis
Risque dâ€™erreur sur la gestion des hooks React (respect strict des rÃ¨gles)
Risque dâ€™incohÃ©rence UX si lâ€™intÃ©gration nâ€™est pas homogÃ¨ne
Risque de doublons ou de perte de donnÃ©es si la logique dâ€™ajout nâ€™est pas bien sÃ©parÃ©e
Risque dâ€™erreur sur la synchronisation du rÃ©fÃ©rentiel alimentaire
Risque dâ€™accessibilitÃ© (suggestions, navigation clavier)
Point de vigilanceâ€¯: bien vÃ©rifier lâ€™ordre et la portÃ©e des hooks, et la prÃ©servation des fonctionnalitÃ©s existantes
Checklist stricte sÃ©curitÃ© & qualitÃ© (Ã  cocher AVANT toute modification)
 Lecture complÃ¨te du code concernÃ© (dÃ©pendances, hooks, variables, fonctionsâ€¦)
 Lecture et analyse des entrÃ©es du fichier docs/Anomalie roll back
 Initialisation systÃ©matique avant usage (hooks, variables, handlers)
 Tous les hooks React sont dÃ©clarÃ©s uniquement en haut du corps du composant fonctionnel
 SÃ©paration stricte des Ã©tapesâ€¯: initialisation, logique calculÃ©e, handlers, rendu
 VÃ©rification de la prÃ©sence/import de toutes les fonctions, hooks et variables utilisÃ©es
 Ordre et portÃ©e logiques stricts
 Pas de doublons ni de dÃ©clarations superflues
 ContrÃ´le dâ€™erreur systÃ©matique (compilation, runtime, SSR, rendu, accessibilitÃ©)
 Test du rendu sur tous les cas dâ€™usage et cas limites
 PrÃ©servation stricte des fonctionnalitÃ©s existantes (aucune suppression destructrice)
 Mise Ã  jour prÃ©cise et justifiÃ©e du pourcentage dâ€™avancement
 Rollback immÃ©diat et rapport dâ€™anomalie en cas dâ€™erreur (docs/Anomalie roll back)
 Documentation claire de chaque Ã©tape et validation utilisateur OBLIGATOIRE
Pourcentage dâ€™avancement estimÃ©
Audit des composantsâ€¯: 100â€¯%
Lecture et analyse du rollbackâ€¯: 0â€¯% (Ã  faire en prioritÃ©)
RÃ©daction du planâ€¯: 100â€¯%
ImplÃ©mentationâ€¯: 0â€¯% (en attente de validation)
Documentation et rapport dâ€™anomalieâ€¯: Ã  complÃ©ter Ã  chaque Ã©tape
Rollback et rapport dâ€™anomalie
Toute anomalie ou erreur â” rollback immÃ©diat, rapport dâ€™anomalie avec contexte, date et heure (cf. fichier docs/Anomalie roll back)
Documentation claire de chaque Ã©tape, chaque validation, et toute action automatisÃ©e (Copilot/IA)
Documentation et validation utilisateur
Documentation de chaque Ã©tape dans le Markdown et le fichier dâ€™anomalie
Validation utilisateur OBLIGATOIRE avant toute implÃ©mentation




20/11/25 9:48ğŸŸ¢ TEMPLATE â€” PLAN Dâ€™IMPLÃ‰MENTATION COPILOT (Ã€ REMPLIR ET VALIDER AVANT TOUTE MODIF CODE)
âš ï¸ AUCUNE modification de code ne doit Ãªtre produite tant que lâ€™utilisateur nâ€™a pas validÃ© explicitement ce plan dâ€™implÃ©mentation rempli par Copilot.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Titre de la tÃ¢che
Masquage par dÃ©faut des informations sensibles dans les encadrÃ©s Â«â€¯dernier profil enregistrÃ©â€¯Â» (page profil) et Â«â€¯suivre mon poidsâ€¯Â» (page suivi/saisie repas), affichables uniquement sur demande

Description prÃ©cise de la modification attendue
Ã€ lâ€™ouverture de la page profil, toutes les infos de lâ€™encadrÃ© Â«â€¯dernier profil enregistrÃ©â€¯Â» (taille, poids, Ã¢ge, etc.) sont masquÃ©es (â€¢â€¢â€¢â€¢ ou floutÃ©es).
Un bouton Â«â€¯Afficher mes donnÃ©esâ€¯Â» permet de rÃ©vÃ©ler lâ€™ensemble des infos de cet encadrÃ©.
Sur la page de suivi/saisie repas, lâ€™encadrÃ© Â«â€¯suivre mon poidsâ€¯Â» est masquÃ© par dÃ©faut.
Un bouton Â«â€¯Afficher mon poidsâ€¯Â» permet de rÃ©vÃ©ler cette information.
Lâ€™Ã©tat dâ€™affichage est gÃ©rÃ© localement, sans impact sur la base de donnÃ©es.
Les autres parties des pages restent inchangÃ©es.
Fichiers concernÃ©s
profil.js (ou le composant profil concernÃ©)
suivi.js ou RepasBloc.js (ou le composant qui gÃ¨re lâ€™encadrÃ© Â«â€¯suivre mon poidsâ€¯Â»)
(Ã€ complÃ©ter selon structure rÃ©elle du projet)
Audit des risques prÃ©alable
Risque dâ€™affichage involontaire des donnÃ©es sensibles si le bouton est mal gÃ©rÃ©.
Risque de confusion UX si le bouton nâ€™est pas assez visible ou explicite.
Risque de non-initialisation de lâ€™Ã©tat local (showSensitive/showWeight).
Risque dâ€™oubli de masquer les donnÃ©es lors dâ€™un refresh ou dâ€™un retour sur la page.
VÃ©rification de la robustesse du code et de la portÃ©e des hooks.
ContrÃ´le de lâ€™accessibilitÃ© (navigation clavier, lisibilitÃ© des boutons).
Risque de rÃ©gression sur lâ€™affichage des autres donnÃ©es du profil ou du suivi.
Identifier lâ€™ordre de tous les hooks React (useState, useEffect, etc.) afin de sâ€™assurer quâ€™ils sont dÃ©clarÃ©s uniquement en haut du corps du composant fonctionnel, et jamais dans une fonction, une boucle, un map, un if, etc. (respect strict des rÃ¨gles officielles des hooks)
Documenter ces risques en point de vigilance et Ã  intÃ©grer dans la checklist du contrÃ´le qualitÃ©.
Sous-checklist Ã  valider systÃ©matiquementâ€¯:
 VÃ©rification de la prÃ©sence/import de toutes les fonctions, hooks et variables utilisÃ©es dans le code modifiÃ©
Checklist stricte sÃ©curitÃ© & qualitÃ© (Ã  cocher AVANT toute modification)
 Lecture complÃ¨te du code concernÃ© (dÃ©pendances, hooks, variables, fonctionsâ€¦)
 Initialisation systÃ©matique avant usage (hooks, variables, handlers)
 Tous les hooks React (useState, useEffect, etc.) sont dÃ©clarÃ©s uniquement en haut du corps du composant fonctionnel, jamais dans une fonction, une boucle, un map, un if, etc. (respect strict des rÃ¨gles officielles des hooks)
 SÃ©paration stricte des Ã©tapesâ€¯: dâ€™abord initialisation (useState, useEffectâ€¦), puis logique calculÃ©e, puis handlers/fonctions, puis rendu
 VÃ©rificationâ€¯: toute fonction ou handler utilisÃ© dans le rendu est prÃ©sent et initialisÃ© avant usage
 Ordre et portÃ©e logiques stricts (jamais dÃ©claration, appel ou usage prÃ©maturÃ©)
 Pas de doublons ni de dÃ©clarations superflues
 ContrÃ´le dâ€™erreur systÃ©matique (compilation, runtime, SSR, rendu, accessibilitÃ©)
 Test du rendu sur tous les cas dâ€™usage et cas limites
 PrÃ©servation stricte des fonctionnalitÃ©s existantesâ€¯: aucune suppression destructrice, aucune perte de comportement
 Mise Ã  jour prÃ©cise et justifiÃ©e du pourcentage dâ€™avancement
 Toute anomalie ou erreur â” rollback immÃ©diat, rapport dâ€™anomalie avec contexte, date et heure (cf. fichier ANOMALIE)
 Documentation claire de chaque Ã©tape, chaque validation, et toute action automatisÃ©e (Copilot/IA)
 Validation utilisateur OBLIGATOIRE avant toute implÃ©mentation
 Toutes les cases ci-dessus doivent Ãªtre cochÃ©es et documentÃ©es avant de poursuivre.
ContrÃ´les conformitÃ© Ã  rÃ©aliser en suivant les Ã©tapes suivantes
Lire toutes les entrÃ©es d'anomalies enregistrÃ©es dans le fichier anomalies Roll back afin dâ€™identifier les points de vigilance pour anticiper le risque dâ€™erreur similaire lors du codage de cette modification.
Suite Ã  cette analyse, crÃ©er une checklist de contrÃ´le Ã  appliquer avant le codage pour sâ€™assurer dâ€™un codage conforme Ã  ajouter dans la section Point de vigilance.
Ajouter analyse de lâ€™audit des risques et sâ€™assurer quâ€™il nâ€™y a aucune anomalie pour garantir la conformitÃ© de la modification.
Si Ã  ce stade anomalie/bug identifiÃ©, alors proposition immÃ©diate de rollback Ã  lâ€™endroit oÃ¹ lâ€™anomalie a Ã©tÃ© dÃ©tectÃ©e (pour revenir Ã  lâ€™Ã©tat oÃ¹ il nâ€™y avait pas de bug), Ã  confirmer avec lâ€™utilisateur ou revenir Ã  lâ€™Ã©tat initial du code avant modification, toujours documenter les anomalies rencontrÃ©es dans le fichier Anomalie roll back avec date et heure.
Mise Ã  jour de lâ€™avancement
 Non commencÃ© | [ ] En cours | [ ] TerminÃ©
Avancement prÃ©cis/Pourcentage rÃ©el (Ã  MAJ Ã  chaque Ã©tape) : ____â€¯%
Historique des mises Ã  jourâ€¯: ___
Point de vigilance
Rapport liÃ© Ã  la lecture des entrÃ©es du fichier anomalie roll back adaptÃ© Ã  la maj actuelleâ€¯: identifier les erreurs similaires que la modification de ce code pourrait gÃ©nÃ©rer suite au retour dâ€™expÃ©rience documentÃ© dans le fichier afin de permettre de les Ã©viter dans cette section en crÃ©ant la checklist de vÃ©rification point de vigilance, informer lâ€™utilisateur quand cette Ã©tape a Ã©tÃ© rÃ©alisÃ©e et informer de lâ€™impact de cette action.
Proposition de rollback
Pour tout risque ou anomalie dÃ©tectÃ©â€¯:
DÃ©crire lâ€™action de rollback, son contexte (fichier, modification en cause), lâ€™alternative sÃ»re proposÃ©e.
Cette donnÃ©e doit Ãªtre ajoutÃ©e dans le fichier ANOMALIE roll backâ€¯: date, heure, dÃ©tail complet pour traÃ§abilitÃ©.
Rapport Markdown Copilot
GÃ©nÃ©rer un rapport structurÃ© AVANT et APRÃˆS toute modification (structure, fonctions, hooks, changements, etc.).
Ce rapport doit permettre une validation Ã©clairÃ©e, claire et synthÃ©tique.
Ã€ valider par lâ€™utilisateur avant code.
ğŸŸ¢ AmÃ©lioration continue (Copilot)
Toujours relier explicitement chaque action utilisateur (exâ€¯: affichage des donnÃ©es sensibles) Ã  la mise Ã  jour des Ã©tats mÃ©tier (activation, affichage dynamique).
VÃ©rifier systÃ©matiquement que chaque Ã©tape du plan est traduite en code et testÃ©e dans le workflow rÃ©el (affichage, activation, masquage, feedback).
AprÃ¨s chaque modification, tester le parcours complet utilisateur et documenter le rÃ©sultat (capture, rapport dâ€™exÃ©cution).
Ne jamais supposer quâ€™un Ã©tat est synchronisÃ© sans vÃ©rification concrÃ¨te (affichage, console, tests).
Ajouter un contrÃ´le visuel ou un feedback Ã  chaque action clÃ© pour garantir la conformitÃ© UX et mÃ©tier.
Documenter toute anomalie ou Ã©cart dans le fichier dÃ©diÃ© et proposer immÃ©diatement une correction ou un rollback.
Relire le plan et le template avant chaque implÃ©mentation pour sâ€™assurer que toutes les Ã©tapes sont respectÃ©es.
Se parler Ã  soi-mÃªme (Copilot)â€¯: Â«â€¯Ai-je bien reliÃ© chaque Ã©tape du plan au codeâ€¯? Ai-je testÃ© le workflow completâ€¯? Ai-je documentÃ© chaque action et chaque anomalieâ€¯?â€¯Â»
Validation explicite de lâ€™utilisateur (OBLIGATOIRE)
 Plan validÃ© par lâ€™utilisateur Ã  la dateâ€¯: ___