â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ›‘ ANOMALIE 18/11/2025 â€” AUDIT RIGOUREUX POST-CORRECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Fichierâ€¯: /pages/preparation-jeune.js
1. Hooks React (`useState`, `useEffect`) dÃ©clarÃ©s hors du composant principal (lignes 2-7)
	- Non conforme Ã  la rÃ¨gle des hooks et au plan strict copilot
	- Risqueâ€¯: erreur Â«â€¯Invalid hook callâ€¯Â» ou comportement inattendu
2. Import React en double (lignes 1 et 52)
	- Non conforme, source potentielle de confusion ou conflit

Cause de lâ€™erreur dâ€™audit prÃ©cÃ©denteâ€¯:
	- Lâ€™audit initial sâ€™est basÃ© sur le contrÃ´le dâ€™erreur automatique (compilation, get_errors) qui nâ€™a pas dÃ©tectÃ© lâ€™anomalie car le code du composant principal Ã©tait conforme et compilait sans erreur.
	- La lecture manuelle complÃ¨te du fichier a rÃ©vÃ©lÃ© la prÃ©sence de hooks hors composant et dâ€™un import en double, non dÃ©tectÃ©s par lâ€™outil automatique.
	- Cette subtilitÃ© montre lâ€™importance de croiser audit automatique et relecture manuelle stricte, comme rappelÃ© dans le plan mÃ©tier.

ProcÃ©dure corrective Ã  suivreâ€¯:
	- Supprimer tout hook hors du composant principal
	- Supprimer lâ€™import React en double
	- RÃ©-auditer le fichier aprÃ¨s correction
	- Documenter lâ€™action dans le rapport dâ€™audit et la section amÃ©lioration continue
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ›‘ ANOMALIE 18/11/2025 â€” VIOLATION RÃˆGLE DES HOOKS REACT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Fichierâ€¯: /pages/preparation-jeune.js
Erreurâ€¯: Hook useState dÃ©clarÃ© hors du composant principal (voir stacktrace)
ConsÃ©quenceâ€¯: Runtime Error Â«â€¯Invalid hook callâ€¯Â»
Causeâ€¯: Non-respect du plan strict copilot (portÃ©e des hooks, checklist)
ProcÃ©dure correctiveâ€¯:
	1. Lecture complÃ¨te du code et de lâ€™historique des anomalies
	2. Correctionâ€¯: dÃ©placer tous les hooks dans le corps du composant principal
	3. Mise Ã  jour du rapport dâ€™audit et de la section amÃ©lioration continue
	4. Validation utilisateur avant toute modification
Lien vers la stacktraceâ€¯: pages/preparation-jeune.js:2:43
Action requiseâ€¯: Correction stricte, traÃ§abilitÃ©, validation
# [2025-11-18] Anomalie React : Invalid hook call dans /pages/ideaux.js
- ProblÃ¨me : Erreur "Invalid hook call. Hooks can only be called inside of the body of a function component." lors de lâ€™ajout du feedback UX palier validÃ©.
- Cause : DÃ©claration dâ€™un hook React (useState/useEffect) en dehors du corps principal du composant fonctionnel (ex : dans une fonction de mapping ou un bloc conditionnel).
- Ã‰tape de la checklist non respectÃ©e : contrÃ´le explicite de lâ€™emplacement des hooks React (voir mise Ã  jour du template).
- Action immÃ©diate : correction du template pour ajouter ce contrÃ´le, dÃ©placement des hooks en haut du composant, test du rendu.
- Date/heure : 2025-11-18, dÃ©tection et documentation.


# [2025-11-17] Anomalies liÃ©es Ã  la correction de lâ€™expÃ©rience dÃ©fi dynamique dans /pages/suivi.js
- ProblÃ¨me 1 : Appel Ã  la fonction inexistante `getWeeklyPalier`, provoquant une erreur ReferenceError lors du calcul du palier hebdomadaire.
- ProblÃ¨me 2 : Retour de la variable `palier` non dÃ©finie dans la fonction `getWeeklyExtrasHistory`, gÃ©nÃ©rant une erreur ReferenceError.
- ProblÃ¨me 3 : Non-respect du template strict (absence de rapport Markdown avant/aprÃ¨s, checklist incomplÃ¨te, absence dâ€™audit de risque exhaustif).
- DÃ©cision : Refus de toutes les modifications initiÃ©es, rollback complet Ã  lâ€™Ã©tat antÃ©rieur, documentation de chaque anomalie.
- Action de rollback :
	- Suppression de lâ€™appel Ã  `getWeeklyPalier` et restauration de la logique dâ€™origine.
	- Correction de `getWeeklyExtrasHistory` pour retourner le tableau `weeks`.
	- Documentation complÃ¨te des erreurs et du processus dans ce fichier.
	- Rappelâ€¯: toute future modification doit respecter strictement le template validÃ©, avec rapport Markdown et audit de risque systÃ©matique.

# [2025-11-17] Anomalie dâ€™insertion composant BandeauDefiActif dans /pages/suivi.js
- ProblÃ¨me : Insertion du composant `BandeauDefiActif` dans la fonction `RetourAccueil` et dans une boucle, provoquant une erreur de build : `Expression expected`.
- Cause : Mauvaise lecture du code, insertion dans une fonction/boucle au lieu du return principal du composant React.
- Ã‰tape de la checklist non respectÃ©e : lecture complÃ¨te du code concernÃ© et test du rendu avant modification.
- Action de rollback : suppression immÃ©diate du code fautif, retour Ã  lâ€™Ã©tat antÃ©rieur du fichier.
- Proposition de correction : insÃ©rer le composant uniquement dans le return principal du composant React exportÃ© par la page (`export default function Suivi() { ... }`).

## [2025-11-17] Anomalie de nommage colonne planData/plan_data
- ProblÃ¨me : Erreur lors de lâ€™ajout dâ€™un idÃ©al : "Could not find the 'planData' column of 'ideaux' in the schema cache".
- Cause : IncohÃ©rence entre le nom de colonne utilisÃ© dans le code (planData) et le schÃ©ma Supabase (plan_data).
- Ã‰tape de la checklist non respectÃ©e : relecture de la cohÃ©rence des noms de colonnes entre le code et la base.
- Correction Ã  faire : harmoniser tous les accÃ¨s Ã  la colonne en snake_case (plan_data) et vÃ©rifier la prÃ©sence de la colonne dans la base.

# [2025-11-18] Anomalie SaisieDefiAlimentaire : ReferenceError categorieOptions is not defined
- ProblÃ¨me : Erreur "categorieOptions is not defined" lors de lâ€™affichage du formulaire dÃ©fi alimentaire.
- Cause : Oubli dâ€™initialisation de la variable `categorieOptions` avant son utilisation dans le JSX (datalist).
- Impact : Blocage de lâ€™affichage du formulaire, impossibilitÃ© de sÃ©lectionner une catÃ©gorie, crash du composant.
- Ã‰tape du plan non respectÃ©e : synchronisation dynamique des listes Ã  partir du rÃ©fÃ©rentiel alimentaire, initialisation des variables avant usage.
- Action immÃ©diate : audit du code modifiÃ©, proposition dâ€™un plan de correction conforme, contrÃ´le qualitÃ© rigoureux.

---








