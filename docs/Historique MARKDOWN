# Rapport Markdown Copilot — Correction & Rollback expérience défi dynamique

**Date : 2025-11-18 — Heure : 09:00**

## État initial avant modification
- Fonction `getWeeklyPalier` absente du code, mais appelée dans `/pages/suivi.js` ➔ provoquait une erreur ReferenceError.
- Fonction `getWeeklyExtrasHistory` retournait une variable `palier` non définie ➔ erreur ReferenceError.
- Plusieurs composants statiques (BandeauDefiActif, PopUpDefi, JournalDeBordDefi) intégrés pour test, mais sans logique dynamique globale.
- Non-respect du template strict : absence de rapport Markdown avant/après, checklist incomplète, audit de risque partiel.

## Modifications apportées (rollback)
- Suppression de l’appel à `getWeeklyPalier` et restauration de la logique d’origine (`currentPalier = 1`).
- Correction de `getWeeklyExtrasHistory` pour retourner le tableau `weeks`.
- Documentation complète de toutes les anomalies dans `Anomalie roll back`.
- Rappel et renforcement de l’obligation de respecter le template strict pour toute future modification.

## État final après rollback
- Plus aucune erreur ReferenceError sur les fonctions/variables citées.
- Fonctionnement restauré sur `/pages/suivi.js`.
- Traçabilité complète assurée (template, anomalie, rapport Markdown).

**Validation utilisateur requise avant toute nouvelle modification.**

# Rapport Markdown Copilot — Anomalie React « Invalid hook call »

**Date : 2025-11-18** 14 32

## État initial avant correction
- Le template d’implémentation ne comportait pas de contrôle explicite sur l’emplacement des hooks React (useState, useEffect, etc.).
- Risque : possibilité d’introduire un bug « Invalid hook call » si un hook est déclaré dans une fonction, une boucle, un map, un if, etc.
- Historique : aucune mention de ce point dans la checklist stricte sécurité & qualité.
- Conséquence : apparition d’une erreur bloquante lors de l’ajout du feedback UX « Palier validé ! » dans `/pages/ideaux.js`.

## Anomalie détectée
- Date/heure : 2025-11-18
- Fichier : `/pages/ideaux.js`
- Erreur : « Invalid hook call. Hooks can only be called inside of the body of a function component. »
- Cause : hook React déclaré en dehors du corps principal du composant fonctionnel.
- Action immédiate : documentation de l’anomalie dans `Anomalie roll back`.

## État après correction
- Le template a été mis à jour :
  - Ajout d’une ligne explicite dans la checklist stricte sécurité & qualité :
    > [ ] Tous les hooks React (useState, useEffect, etc.) sont déclarés uniquement en haut du corps du composant fonctionnel, jamais dans une fonction, une boucle, un map, un if, etc. (respect strict des règles officielles des hooks)
- L’anomalie est documentée dans le fichier `Anomalie roll back`.
- La procédure de traçabilité et de prévention est renforcée pour toutes les futures tâches.

## Prochaine étape
- Corriger le code de `/pages/ideaux.js` si le bug est encore présent (déplacer tous les hooks en haut du composant fonctionnel).
- Tester le rendu et valider la correction.
- Continuer la documentation et la validation utilisateur.

*Rapport généré automatiquement par Copilot le 18/11/2025.*


Rapport Markdown Copilot — Initialisation synchronisation critères préparation
Date : 2025-11-19 — Heure : 9:00

État initial avant modification
Absence de fonction utilitaire partagée pour la validation des critères de préparation.
Logique de validation du critère dupliquée dans preparation-jeune.js et suivi.js.
Risque de désynchronisation, de régression et de non-respect du template strict (séparation initialisation/logique/handler/rendu).
Historique d’anomalies sur l’emplacement des hooks, la duplication de logique, et l’absence de rapport Markdown avant/après.
Points de vigilance issus de l’audit et des anomalies
Vérifier que tous les hooks React sont déclarés uniquement en haut du composant principal.
S’assurer que la fonction utilitaire est importée et utilisée dans les deux pages, sans duplication de logique métier.
Contrôler la synchronisation réelle de l’état métier entre les deux pages (test manuel et console).
Générer un rapport Markdown avant/après modification et documenter toute anomalie ou rollback.
Respecter la checklist stricte du template à chaque étape.
Plan d’action
Création de /lib/validerCriterePreparation.js (fonction utilitaire centralisée).
Modification stricte des appels dans preparation-jeune.js et suivi.js pour utiliser cette fonction.
Audit, documentation, et contrôle qualité systématique.
Prochaine étape
Création du fichier utilitaire et modification des pages concernées, en respectant la checklist et la traçabilité.
Rapport Markdown final après modification.

Rapport généré automatiquement par Copilot le 19/11/2025.



